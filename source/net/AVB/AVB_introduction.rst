车载以太网AVB概述
=======================


音视频传输问题
-----------------

在观看网络视频时经常会遇到卡顿，花屏，延时大，音视频不同步等问题，造成以上问题的主要原因有两点

- 网络不流畅，数据丢失或不能及时到达

- 多媒体同步问题


这也是AVB要解决的主要问题，不同的是我们观看网络视频一般是经由广域网传输，而AVB解决的是局域网内音视频传输的问题

网络传输问题
^^^^^^^^^^^^^^^


传统以太网是基于竞争的"尽最大努力传输"的分组报文网络，有人说TCP是可靠的，但是TCP的可靠性是建立在重传机制上的，带来的副作用就是延时加大．
另外转发节点(比如网络中的交换机，路由器)对报文的传输影响比较大．比如

- 传输过程中，如果中间的转发节点缓存队列已满，会导致后续数据包丢失

- 传输时延受转发节点的缓存状态影响，如果缓存队列中数据较多，传输延迟就比较大


多媒体同步问题
^^^^^^^^^^^^^^^

多媒体同步包含两个方面的内容

- 媒体时钟恢复(频率同步)，它解决的是按什么样的速度播放的问题

- 播放时间同步(相位同步)，它解决的是什么时候播放的问题

AVB体系
---------

AVB被称为时间敏感网络，它主要解决两个问题:

- 延时问题：通过带宽预留，保证延时小，实时性好(延时可控，最坏情况下的延时不超过一定的阈值)

- 同步问题：
    - 媒体时钟同步：不同的媒体类型有自己的媒体时钟，这些媒体时钟都映射到gPTP时间(同一个时间坐标系)，接收端可以轻松进行媒体时钟恢复

    - 播放时间同步：数据发送时指示接收方在未来的某个时间点播放，如果有多个接收者，他们就会在未来的同一时刻同时播放

协议框架
^^^^^^^^^^^

AVB的全称是Audio Video Bridging,由一系列IEEE标准组成，目的是在局域网中高效传输音视频数据．

AVB协议栈如下图所示：

.. image::
    res/AVB_IEEE.image

可以看出AVB主要是链路层协议，它和传统的TCP/IP协议栈是并列共存的关系．AVB协议栈不仅包括了前面提到的带宽预留和时钟同步协议，还包括了其他一些辅助
协议，如下

1. 精确时钟同步协议(gPTP): 用来将网络内所有节点的时钟同步到一个主时钟

2. 带宽预留协议(SRP)

3. 流量整形协议(FQTSS): 负责对流量进行排队，转发管理

4. 音视频传输协议(AVTP)

5. 音视频管理协议(AVDECC): 负责服务发现，节点能力遍历，链接管理等控制功能

6. 基于AVB的RTP/RTCP传输协议: 它主要是将传统的RTP/RTCP流映射到AVB流，使用AVB性能，从而降低延迟，提高同步精度


AVB官方网站 https://avb.statusbar.com/page/developer-faq/





